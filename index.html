<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BST Guesser</title>
    
    <!-- Move XLSX script here, after DOCTYPE -->
    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                var filteredData = jsonData.filter(row => row.some(filledCell));
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <meta name="google-adsense-account" content="ca-pub-2677128924988240">
    
    <!-- Use alternative Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0f1729 !important; /* Darker, more faded blue background */
            color: white !important; /* White text */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        canvas {
            max-width: 450px;
            margin: 0 auto;
            height: 300px !important;
        }
        #pokemonSprite {
            max-width: 300px !important;
            width: 300px !important; /* Force a fixed width instead of 100% */
            height: auto;
            margin-bottom: 1rem;
            display: block; /* Ensure consistent display */
        }
        .blurred-grey {
            filter: blur(30px) grayscale(100%); /* Changed from 35px to 30px */
        }
        #statChart {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        /* Override any dark text */
        p, h1, h2, h3, label, summary {
            color: white !important;
        }
        /* Style the footer as static at bottom */
        footer {
            background-color: #1e40af !important;
            margin-top: auto;
            position: relative;
            bottom: 0;
            width: 100%;
        }
        /* Center main title with nice border */
        .main-title {
            text-align: center;
            font-weight: 700;
            letter-spacing: -0.025em;
            border: 3px solid #60a5fa;
            border-radius: 12px;
            padding: 16px 24px;
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(147, 197, 253, 0.1));
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 0 auto;
            display: inline-block;
        }
        /* Main content wrapper */
        .main-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 200px);
            width: 100%;
        }

        /* Ensure home menu is properly centered */
        #homeMenu {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Ensure game screen is properly centered */
        #gameScreen {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Add this to your existing <style> section */
        #guessInput {
            color: black !important;
            background-color: white !important;
        }

        /* Also style the datalist options */
        #pokemon-list option {
            color: black;
            background-color: white;
        }

        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #60a5fa;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }
    </style>
</head>
<body style="background-color: #0f1729;">
    <div class="main-content">
        <div id="homeMenu" class="flex flex-col items-center justify-center space-y-4 mx-auto">
            <h1 class="main-title text-4xl font-bold mb-6 text-white">BST Guesser</h1>
            <div class="flex items-center space-x-4">
                <label for="fullyEvolvedToggle" class="text-lg font-semibold">Only Fully Evolved Pokémon</label>
                <input id="fullyEvolvedToggle" type="checkbox" class="h-5 w-5">
            </div>
            <button id="dailyChallengeButton" class="bg-blue-500 text-white px-6 py-3 rounded hover:bg-blue-600 text-lg">Daily Challenge</button>
            <button id="infiniteModeButton" class="bg-purple-500 text-white px-6 py-3 rounded hover:bg-purple-600 text-lg">Infinite Quiz</button>
        </div>
        
        <!-- Add loading screen -->
        <div id="loadingScreen" class="hidden loading-container">
            <div class="loading-spinner"></div>
            <p class="text-lg text-white">Loading Pokémon...</p>
        </div>
        
        <div id="gameScreen" class="hidden flex flex-col items-center justify-center w-full mx-auto">
            <h1 id="gameTitle" class="main-title text-3xl font-bold mb-4 mx-auto text-white text-center"></h1>
            <div class="mb-4 mx-auto">
                <p id="message" class="text-lg text-center"></p>
                <p id="guesses" class="text-lg text-center font-semibold">Total Guesses: 0</p>
                <p id="progress" class="text-lg text-center font-semibold">Pokémon: 1/5</p>
            </div>
            <div class="flex flex-col lg:flex-row items-center justify-center lg:space-x-4 w-full max-w-4xl mx-auto">
                <div class="flex flex-col items-center">
                    <img id="pokemonSprite" alt="Pokémon Sprite" class="blurred-grey mx-auto" />
                    <!-- Add hints section below the sprite -->
                    <div id="hints" class="text-center mt-4">
                        <p id="typeHint" class="text-lg"><span style="color: #9ca3af;">Type(s): ???</span></p>
                        <p id="abilityHint" class="text-lg"><span style="color: #9ca3af;">Ability: ???</span></p>
                    </div>
                </div>
                <canvas id="statChart" class="mb-2 mx-auto"></canvas>
            </div>
            <div class="flex flex-col items-center justify-center space-y-4 mx-auto">
                <input id="guessInput" type="text" placeholder="Enter Pokémon name" class="border p-2 rounded w-64" list="pokemon-list">
                <datalist id="pokemon-list">
                    <!-- Options will be added by JavaScript -->
                </datalist>
                <div class="flex flex-row items-center justify-center space-x-2 mt-2">
                    <button id="returnToMenuButton" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Return to Menu</button>
                    <button id="nextButton" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Next Pokémon</button>
                    <button id="restartButton" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 hidden">Restart Challenge</button>
                    <button id="guessButton" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Submit Guess</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Your existing footer and script code -->
    <script>
// Game variables
let currentPokemon = null;
let pokemonQueue = [];
let currentPokemonIndex = 0;
let totalGuesses = 0;
let currentBlur = 30; // Changed from 35 to 30
let myChart = null;
let gameMode = '';
let incorrectGuesses = 0;

// DOM elements
const dailyChallengeButton = document.getElementById('dailyChallengeButton');
const infiniteModeButton = document.getElementById('infiniteModeButton');
const homeMenu = document.getElementById('homeMenu');
const gameScreen = document.getElementById('gameScreen');
const gameTitle = document.getElementById('gameTitle');
const returnToMenuButton = document.getElementById('returnToMenuButton');
const pokemonSprite = document.getElementById('pokemonSprite');
const statChart = document.getElementById('statChart');
const guessInput = document.getElementById('guessInput');
const guessButton = document.getElementById('guessButton');
const nextButton = document.getElementById('nextButton');
const restartButton = document.getElementById('restartButton');
const message = document.getElementById('message');
const guessesDisplay = document.getElementById('guesses');
const progressDisplay = document.getElementById('progress');
const fullyEvolvedToggle = document.getElementById('fullyEvolvedToggle');
const loadingScreen = document.getElementById('loadingScreen');

// Pokemon names for autocomplete
const allPokemonNames = [];

// Event listeners
dailyChallengeButton.addEventListener('click', () => startGame('daily'));
infiniteModeButton.addEventListener('click', () => startGame('infinite'));
returnToMenuButton.addEventListener('click', returnToMenu);
guessButton.addEventListener('click', checkGuess);
nextButton.addEventListener('click', nextPokemon);
restartButton.addEventListener('click', () => startGame(gameMode));

// Enter key support
guessInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        checkGuess();
    }
});

// Initialize autocomplete
async function initializeAutocomplete() {
    try {
        const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=1025');
        const data = await response.json();
        const datalist = document.getElementById('pokemon-list');
        datalist.innerHTML = "";
        data.results.forEach(p => {
            const name = p.name.charAt(0).toUpperCase() + p.name.slice(1);
            allPokemonNames.push(name.toLowerCase());
            const option = document.createElement('option');
            option.value = name;
            datalist.appendChild(option);
        });
    } catch (error) {
        console.error('Error loading Pokemon names:', error);
    }
}

// Start game
async function startGame(mode) {
    gameMode = mode;
    
    // Show loading screen, hide other screens
    homeMenu.classList.add('hidden');
    gameScreen.classList.add('hidden');
    loadingScreen.classList.remove('hidden');
    
    if (mode === 'daily') {
        gameTitle.textContent = 'Daily Challenge';
    } else {
        gameTitle.textContent = 'Infinite Quiz';
    }
    
    // Reset game state
    currentPokemonIndex = 0;
    totalGuesses = 0;
    pokemonQueue = [];
    
    try {
        // Generate Pokemon queue
        await generatePokemonQueue();
        
        // Load first Pokemon
        await loadPokemon(0);
        
        // Hide loading screen, show game screen
        loadingScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        
        // Update UI
        guessButton.classList.remove('hidden');
        nextButton.classList.add('hidden');
        restartButton.classList.add('hidden');
        guessesDisplay.textContent = 'Total Guesses: 0';
        progressDisplay.textContent = `Pokémon: 1/${pokemonQueue.length}`;
    } catch (error) {
        console.error('Error starting game:', error);
        // Hide loading screen, show home menu on error
        loadingScreen.classList.add('hidden');
        homeMenu.classList.remove('hidden');
    }
}

// Generate Pokemon queue
async function generatePokemonQueue() {
    const onlyFullyEvolved = fullyEvolvedToggle.checked;
    const queueSize = gameMode === 'daily' ? 5 : 10;
    
    let attempts = 0;
    const maxAttempts = queueSize * 10; // Allow more attempts to find enough Pokemon
    
    while (pokemonQueue.length < queueSize && attempts < maxAttempts) {
        let pokemonId;
        if (gameMode === 'daily') {
            // Use seed for daily challenge
            const today = new Date().toDateString();
            const seed = hashCode(today + attempts);
            pokemonId = (Math.abs(seed) % 1025) + 1;
        } else {
            pokemonId = Math.floor(Math.random() * 1025) + 1;
        }
        
        try {
            const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonId}`);
            const pokemon = await response.json();
            
            // Check if we already have this Pokemon in the queue
            if (pokemonQueue.some(p => p.id === pokemon.id)) {
                attempts++;
                continue;
            }
            
            if (onlyFullyEvolved) {
                const speciesResponse = await fetch(pokemon.species.url);
                const species = await speciesResponse.json();
                const evolutionResponse = await fetch(species.evolution_chain.url);
                const evolution = await evolutionResponse.json();
                
                if (isFullyEvolved(pokemon.name, evolution.chain)) {
                    pokemonQueue.push(pokemon);
                }
            } else {
                pokemonQueue.push(pokemon);
            }
        } catch (error) {
            console.error('Error fetching Pokemon:', error);
        }
        
        attempts++;
    }
    
    // If we still don't have enough Pokemon, fill with any random ones
    while (pokemonQueue.length < queueSize) {
        try {
            const pokemonId = Math.floor(Math.random() * 1025) + 1;
            const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonId}`);
            const pokemon = await response.json();
            
            // Check if we already have this Pokemon
            if (!pokemonQueue.some(p => p.id === pokemon.id)) {
                pokemonQueue.push(pokemon);
            }
        } catch (error) {
            console.error('Error fetching fallback Pokemon:', error);
            break;
        }
    }
}

// Hash function for daily challenge
function hashCode(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return hash;
}

// Check if Pokemon is fully evolved
function isFullyEvolved(pokemonName, evolutionChain) {
    function findInChain(chain) {
        if (chain.species.name === pokemonName) {
            return chain.evolves_to.length === 0;
        }
        for (let evolution of chain.evolves_to) {
            const result = findInChain(evolution);
            if (result !== null) return result;
        }
        return null;
    }
    return findInChain(evolutionChain);
}

// Load Pokemon
async function loadPokemon(index) {
    if (index >= pokemonQueue.length) {
        endGame();
        return;
    }
    
    currentPokemon = pokemonQueue[index];
    incorrectGuesses = 0;
    currentBlur = 30; // Changed from 35 to 30
    
    // Update sprite
    pokemonSprite.src = currentPokemon.sprites.front_default;
    pokemonSprite.classList.add('blurred-grey');
    pokemonSprite.style.filter = 'blur(30px) grayscale(100%)'; // Changed from 35px to 30px
    
    // Create chart
    createChart(currentPokemon.stats, currentPokemon.name);
    
    // Update progress
    progressDisplay.textContent = `Pokémon: ${index + 1}/${pokemonQueue.length}`;
    
    // Clear input and set initial message and hints
    guessInput.value = '';
    message.textContent = 'Guess the Pokémon!';
    document.getElementById('typeHint').innerHTML = '<span style="color: #9ca3af;">Type(s): ???</span>';
    document.getElementById('abilityHint').innerHTML = '<span style="color: #9ca3af;">Ability: ???</span>';
    guessInput.focus();
}

// Create chart
function createChart(stats, pokemonName) {
    if (myChart) myChart.destroy();
    
    const statLabels = ['HP', 'Attack', 'Defense', 'Sp. Atk', 'Sp. Def', 'Speed'];
    const statValues = stats.map(stat => stat.base_stat);
    const totalStat = statValues.reduce((sum, val) => sum + val, 0);
    const backgroundColors = statValues.map(value => getGradientColor(value));
    const borderColors = statValues.map(value => getGradientColor(value).replace('0.6', '1'));

    myChart = new Chart(statChart, {
        type: 'bar',
        data: {
            labels: statLabels,
            datasets: [{
                label: `Base Stat Total: ${totalStat}`,
                data: statValues,
                backgroundColor: backgroundColors,
                borderColor: borderColors,
                borderWidth: 1,
                barThickness: 25
            }]
        },
        options: {
            devicePixelRatio: window.devicePixelRatio || 2,
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: 'y',
            scales: {
                x: {
                    beginAtZero: true,
                    max: 255,
                    display: false
                },
                y: {
                    title: {
                        display: false
                    },
                    ticks: {
                        color: '#d1d5db', // Light gray color for stat labels
                        font: {
                            size: 13
                        },
                        padding: 5
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: '#f3f4f6' // Light color for legend text
                    }
                },
                datalabels: {
                    anchor: 'end',
                    align: 'end',
                    formatter: (value) => value,
                    color: '#ffffff', // Changed to white for stat value labels
                    font: {
                        weight: 'bold'
                    }
                }
            }
        }
    });
}

// Get gradient color for stats
function getGradientColor(value) {
    if (value <= 30) return 'rgba(239, 68, 68, 0.6)';
    if (value <= 60) return 'rgba(249, 115, 22, 0.6)';
    if (value <= 90) return 'rgba(245, 158, 11, 0.6)';
    if (value <= 120) return 'rgba(132, 204, 22, 0.6)';
    if (value <= 150) return 'rgba(34, 197, 94, 0.6)';
    return 'rgba(16, 185, 129, 0.6)';
}

// Check guess
function checkGuess() {
    totalGuesses++;
    guessesDisplay.textContent = `Total Guesses: ${totalGuesses}`;
    const guess = guessInput.value.trim().toLowerCase();
    
    if (guess === currentPokemon.name) {
        message.textContent = `Correct! It's ${currentPokemon.name.charAt(0).toUpperCase() + currentPokemon.name.slice(1)}!`;
        pokemonSprite.classList.remove('blurred-grey');
        pokemonSprite.style.filter = 'none';
        pokemonSprite.style.width = '300px'; // Force the width to stay the same
        pokemonSprite.style.maxWidth = '300px'; // Ensure max-width stays consistent
        guessButton.classList.add('hidden');
        nextButton.classList.remove('hidden');
    } else {
        incorrectGuesses++;
        currentBlur = Math.max(currentBlur - 3, 0);
        pokemonSprite.style.filter = `blur(${currentBlur}px) grayscale(100%)`;

        // Get ability and type hints
        const abilityHint = currentPokemon.abilities[0].ability.name.charAt(0).toUpperCase() + currentPokemon.abilities[0].ability.name.slice(1);
        const typeHint = currentPokemon.types.map(t => t.type.name.charAt(0).toUpperCase() + t.type.name.slice(1)).join(', ');

        // Update message and hints based on incorrect guess count
        message.textContent = 'Incorrect.';
        
        if (incorrectGuesses === 2) {
            // First hint: reveal TYPE
            document.getElementById('typeHint').textContent = `Type(s): ${typeHint}`;
        } else if (incorrectGuesses >= 3) {
            // Second hint: reveal ABILITY (keep type shown)
            document.getElementById('typeHint').textContent = `Type(s): ${typeHint}`;
            document.getElementById('abilityHint').textContent = `Ability: ${abilityHint}`;
        }
    }
    guessInput.value = '';
    guessInput.focus();
}

// Next Pokemon
function nextPokemon() {
    currentPokemonIndex++;
    if (currentPokemonIndex >= pokemonQueue.length) {
        endGame();
    } else {
        loadPokemon(currentPokemonIndex);
        guessButton.classList.remove('hidden');
        nextButton.classList.add('hidden');
    }
}

// End game
function endGame() {
    message.textContent = `Game complete! Total guesses: ${totalGuesses}`;
    guessButton.classList.add('hidden');
    nextButton.classList.add('hidden');
    restartButton.classList.remove('hidden');
    pokemonSprite.style.display = 'none';
    if (myChart) myChart.destroy();
}

// Return to menu
function returnToMenu() {
    gameScreen.classList.add('hidden');
    loadingScreen.classList.add('hidden');
    homeMenu.classList.remove('hidden');
    if (myChart) myChart.destroy();
    pokemonSprite.style.display = 'block';
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    initializeAutocomplete();
    Chart.register(ChartDataLabels);
});
</script>
    
    <footer class="w-full bg-gray-200 py-4 mt-8 flex flex-col items-center justify-center text-center text-sm">
        <div class="max-w-2xl px-4 w-full">
            <details class="mb-2">
                <summary class="cursor-pointer font-semibold text-gray-800">Privacy Policy</summary>
                <p class="mt-2 text-gray-700">
                    This website does not collect personal information. Third-party services (such as ad networks) may use cookies for analytics and advertising.
                </p>
            </details>
            <details>
                <summary class="cursor-pointer font-semibold text-gray-800">Terms of Service</summary>
                <p class="mt-2 text-gray-700">
                    By using this site, you agree to use it for entertainment purposes only. All Pokémon data is provided by the PokéAPI and is for non-commercial use.
                </p>
            </details>
            
            <!-- Footer AdSense Ad 
            <div class="my-4 flex justify-center">
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-2677128924988240"
                     data-ad-slot="1234567890"
                     data-ad-format="auto"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>-->

            <p class="mt-4 text-gray-500">&copy; 2025 BST Guesser</p>
        </div>
    </footer>
</body>
</html>

